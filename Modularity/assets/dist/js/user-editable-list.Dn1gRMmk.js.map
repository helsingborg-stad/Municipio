{"version":3,"file":"user-editable-list.Dn1gRMmk.js","sources":["../../../source/js/private/userEditableList.ts"],"sourcesContent":["import { ValuesInterface, ItemsObject } from \"../interface/privateModules\";\n\nclass UserEditableList {\n\tprivate savingLang: string = \"Saving\";\n\tprivate buttonText: string;\n\n\tconstructor(\n\t\tprivate submitButton: HTMLButtonElement,\n\t\tprivate closeButton: HTMLButtonElement,\n\t\tprivate errorNotice: HTMLElement,\n\t\tprivate itemsObject: ItemsObject,\n\t\tprivate checkboxes: NodeListOf<HTMLInputElement>,\n\t\tprivate readonly userId: string,\n\t\tprivate readonly moduleId: string,\n\t\tprivate metaKey: string,\n\t) {\n\t\tthis.buttonText = this.submitButton.textContent ?? \"Save\";\n\t\tthis.savingLang =\n\t\t\tthis.submitButton.getAttribute(\"data-js-saving-lang\") ?? this.savingLang;\n\n\t\tif (wpApiSettings) {\n\t\t\tthis.submitListener();\n\t\t}\n\t}\n\n\tprivate submitListener() {\n\t\tthis.submitButton.addEventListener(\"click\", (event) => {\n\t\t\tevent.preventDefault();\n\n\t\t\tlet values: ValuesInterface = {};\n\n\t\t\tthis.checkboxes.forEach((checkbox) => {\n\t\t\t\tvalues[checkbox.value] = checkbox.checked;\n\t\t\t});\n\n\t\t\tthis.patchUser(values);\n\t\t});\n\t}\n\n\tprivate patchUser(values: ValuesInterface) {\n\t\tthis.handleBeforeSave();\n\n\t\tconst endpoint = `${wpApiSettings?.root}wp/v2/users/${this.userId}`;\n\t\tfetch(endpoint, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"X-WP-NONCE\": wpApiSettings?.nonce ?? \"\",\n\t\t\t},\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tthrow new Error(\"Failed to fetch existing user data\");\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then((data) => {\n\t\t\t\tlet metaData = data.meta ? data.meta[this.metaKey] : null;\n\n\t\t\t\tif (\n\t\t\t\t\t!metaData ||\n\t\t\t\t\ttypeof metaData !== \"object\" ||\n\t\t\t\t\tArray.isArray(metaData)\n\t\t\t\t) {\n\t\t\t\t\tmetaData = {};\n\t\t\t\t}\n\n\t\t\t\tmetaData[this.moduleId] = values;\n\n\t\t\t\treturn fetch(endpoint, {\n\t\t\t\t\tmethod: \"PATCH\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\t\"X-WP-NONCE\": wpApiSettings?.nonce ?? \"\",\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tmeta: {\n\t\t\t\t\t\t\t[this.metaKey]: metaData,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.handleSuccessfullSave(values);\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error(\"Error:\", error);\n\t\t\t\tthis.handleFailedSave();\n\t\t\t});\n\t}\n\n\tprivate handleBeforeSave() {\n\t\tthis.submitButton.disabled = true;\n\t\tthis.closeButton.disabled = true;\n\n\t\tthis.submitButton.textContent = this.savingLang;\n\t}\n\n\tprivate handleFailedSave() {\n\t\tthis.errorNotice.classList.remove(\"u-display--none\");\n\t\tthis.submitButton.disabled = false;\n\t\tthis.closeButton.disabled = false;\n\t\tthis.submitButton.textContent = this.buttonText;\n\t}\n\n\tprivate handleSuccessfullSave(values: ValuesInterface) {\n\t\tthis.submitButton.disabled = false;\n\t\tthis.closeButton.disabled = false;\n\t\tthis.submitButton.textContent = this.buttonText;\n\t\tthis.showOrHideItemsBasedOnSaved(values);\n\t\tthis.closeButton.click();\n\t}\n\n\tprivate showOrHideItemsBasedOnSaved(values: ValuesInterface) {\n\t\tfor (const [key, element] of Object.entries(this.itemsObject)) {\n\t\t\tif (!(key in values)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (values[key]) {\n\t\t\t\telement.classList.remove(\"u-display--none\");\n\t\t\t} else {\n\t\t\t\telement.classList.add(\"u-display--none\");\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport default function initUserEditableList(userEditable: HTMLElement) {\n\tconst metaKey = userEditable.getAttribute(\"data-js-user-editable\");\n\n\tif (!metaKey) {\n\t\treturn;\n\t}\n\n\tconst userId = userEditable.getAttribute(\"data-js-user-editable-user\");\n\tconst moduleId = userEditable.getAttribute(\"data-js-user-editable-id\");\n\tconst submitButton = userEditable.querySelector('button[type=\"submit\"]');\n\tconst checkboxes = userEditable.querySelectorAll(\n\t\t'input[type=\"checkbox\"]',\n\t) as NodeListOf<HTMLInputElement>;\n\tconst errorNotice = userEditable.querySelector(\n\t\t\"[data-js-user-editable-error]\",\n\t);\n\tlet itemsObject: ItemsObject = {};\n\n\tuserEditable.querySelectorAll(\"[data-js-item-id]\").forEach((item) => {\n\t\tconst itemId = item.getAttribute(\"data-js-item-id\");\n\t\tif (itemId) {\n\t\t\titemsObject[itemId] = item as HTMLElement;\n\t\t}\n\t});\n\n\tconst closeButton = userEditable.querySelector(\"button[data-js-cancel-save]\");\n\n\tif (submitButton && closeButton && userId && moduleId && checkboxes.length) {\n\t\tnew UserEditableList(\n\t\t\tsubmitButton as HTMLButtonElement,\n\t\t\tcloseButton as HTMLButtonElement,\n\t\t\terrorNotice as HTMLElement,\n\t\t\titemsObject,\n\t\t\tcheckboxes,\n\t\t\tuserId,\n\t\t\tmoduleId,\n\t\t\tmetaKey,\n\t\t);\n\t}\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n\tdocument\n\t\t.querySelectorAll(\"[data-js-user-editable]\")\n\t\t.forEach((userEditable) => {\n\t\t\tinitUserEditableList(userEditable as HTMLElement);\n\t\t});\n});\n"],"names":[],"mappings":"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"}