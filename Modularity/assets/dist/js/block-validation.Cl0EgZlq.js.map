{"version":3,"file":"block-validation.Cl0EgZlq.js","sources":["../../../source/js/block-error-notice.ts","../../../source/js/block-validation.ts"],"sourcesContent":["export default class BlockErrorNotice {\n\tfieldGroup: HTMLElement;\n\tfield: HTMLTextAreaElement | null;\n\tnoticeElement: HTMLElement | false;\n\tregex: RegExp;\n\terrorMessage: string;\n\tnotice: HTMLElement | null;\n\n\tconstructor(fieldGroup: HTMLElement, regex: RegExp, errorMessage: string) {\n\t\tthis.fieldGroup = fieldGroup;\n\t\tthis.field = fieldGroup.querySelector(\"textarea\");\n\t\tthis.noticeElement = false;\n\t\tthis.regex = regex;\n\t\tthis.errorMessage = errorMessage;\n\t\tthis.notice = null;\n\n\t\tthis.field && this.init();\n\t}\n\n\tinit() {\n\t\tthis.createNotice();\n\t\tthis.checkFieldValue();\n\t\tthis.setupTextareaListener();\n\t}\n\n\tprivate createNotice() {\n\t\tconst noticeString = `\n            <div class=\"c-notice\" style=\"margin-bottom: 16px; display: none; background-color: #d73740; color: white; padding: 16px 24px; border-radius: 4px;\" data-js-block-error-notice>\n            <span class=\"c-notice__icon\" margin-right: 16px;>\n            <span class=\"c-icon c-icon--report c-icon--material c-icon--material-report material-icons c-icon--size-md\" role=\"img\" aria-label=\"Icon: Undefined\" alt=\"Icon: Undefined\"><span data-nosnippet=\"\" translate=\"no\" aria-hidden=\"true\">report</span></span></span>\n            <span id=\"notice__text__\" for=\"\" class=\"c-notice__message\">${this.errorMessage}</span>\n            </div>`;\n\n\t\tconst div = document.createElement(\"div\");\n\n\t\tdiv.innerHTML = noticeString;\n\n\t\tthis.fieldGroup.insertBefore(div, this.fieldGroup.firstChild);\n\n\t\tconst notice = this.fieldGroup.querySelector(\n\t\t\t\"[data-js-block-error-notice]\",\n\t\t) as HTMLElement | null;\n\t\tif (notice) {\n\t\t\tthis.notice = notice;\n\t\t}\n\t}\n\n\tprivate checkFieldValue() {\n\t\tconst faultyScriptElement = this.checkRegex();\n\t\tif (faultyScriptElement) {\n\t\t\tthis.fieldGroup.setAttribute(\"data-js-block-field-validation-error\", \"\");\n\t\t\tif (this.notice) {\n\t\t\t\tthis.notice.style.display = \"block\";\n\t\t\t}\n\t\t} else {\n\t\t\tthis.fieldGroup.removeAttribute(\"data-js-block-field-validation-error\");\n\t\t\tthis.notice && (this.notice.style.display = \"none\");\n\t\t}\n\t}\n\n\tpublic getFaultyScriptModules() {\n\t\treturn (\n\t\t\tdocument.querySelectorAll(\"[data-js-block-field-validation-error]\")\n\t\t\t\t.length > 0\n\t\t);\n\t}\n\n\tprivate setupTextareaListener() {\n\t\tthis.field &&\n\t\t\tthis.field.addEventListener(\"input\", () => {\n\t\t\t\tthis.checkFieldValue();\n\t\t\t});\n\n\t\tthis.field &&\n\t\t\tthis.field.addEventListener(\"change\", () => {\n\t\t\t\tthis.checkFieldValue();\n\t\t\t});\n\t}\n\n\tprivate checkRegex() {\n\t\treturn this.regex.test(this.field?.value || \"\");\n\t}\n}\n","import BlockErrorNotice from \"./block-error-notice\";\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n\tcreateValidation(\n\t\t'[data-key=\"field_56a8b9f1902a6\"]',\n\t\t\"acf/script\",\n\t\t/<iframe|<video/,\n\t\t\"Please use a more appropriate module for your content. (video or iframe module)\",\n\t);\n});\n\nfunction createValidation(\n\tblockDataKey: string,\n\tblockDataType: string,\n\tregex: RegExp,\n\terrorMessage: string,\n) {\n\tif (!blockDataKey || !blockDataType || !regex || !errorMessage) return;\n\n\tconst fieldGroups = [...document.querySelectorAll<HTMLElement>(blockDataKey)];\n\tfieldGroups.forEach((fieldGroup) => {\n\t\tnew BlockErrorNotice(fieldGroup, regex, errorMessage);\n\t});\n\n\tconst observer = new MutationObserver((mutationsList) => {\n\t\tmutationsList.forEach((mutation) => {\n\t\t\tif (mutation.type === \"childList\" && mutation.addedNodes.length > 0) {\n\t\t\t\tmutation.addedNodes.forEach((addedNode) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\taddedNode instanceof HTMLElement &&\n\t\t\t\t\t\taddedNode.hasAttribute(\"data-type\") &&\n\t\t\t\t\t\taddedNode.getAttribute(\"data-type\") == blockDataType\n\t\t\t\t\t) {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tlet fieldGroup = addedNode.querySelector(\n\t\t\t\t\t\t\t\tblockDataKey,\n\t\t\t\t\t\t\t) as HTMLElement;\n\t\t\t\t\t\t\tif (fieldGroup) {\n\t\t\t\t\t\t\t\tnew BlockErrorNotice(fieldGroup, regex, errorMessage);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\n\tconst config = { childList: true, subtree: true };\n\tobserver.observe(document, config);\n}\n"],"names":[],"mappings":"gHAAA,MAAqB,kBAArB,MAAqB,iBAAiB,CACrC,WACA,MACA,cACA,MACA,aACA,OAEA,YAAY,WAAyB,MAAe,aAAsB,CACzE,KAAK,WAAa,WAClB,KAAK,MAAQ,WAAW,cAAc,UAAU,EAChD,KAAK,cAAgB,GACrB,KAAK,MAAQ,MACb,KAAK,aAAe,aACpB,KAAK,OAAS,KAEd,KAAK,OAAS,KAAK,KAAA,CACpB,CAEA,MAAO,CACN,KAAK,aAAA,EACL,KAAK,gBAAA,EACL,KAAK,sBAAA,CACN,CAEQ,cAAe,CACtB,MAAM,aAAe;AAAA;AAAA;AAAA;AAAA,yEAIkD,KAAK,YAAY;AAAA,oBAGlF,IAAM,SAAS,cAAc,KAAK,EAExC,IAAI,UAAY,aAEhB,KAAK,WAAW,aAAa,IAAK,KAAK,WAAW,UAAU,EAE5D,MAAM,OAAS,KAAK,WAAW,cAC9B,8BAAA,EAEG,SACH,KAAK,OAAS,OAEhB,CAEQ,iBAAkB,CACG,KAAK,WAAA,GAEhC,KAAK,WAAW,aAAa,uCAAwC,EAAE,EACnE,KAAK,SACR,KAAK,OAAO,MAAM,QAAU,WAG7B,KAAK,WAAW,gBAAgB,sCAAsC,EACtE,KAAK,SAAW,KAAK,OAAO,MAAM,QAAU,QAE9C,CAEO,wBAAyB,CAC/B,OACC,SAAS,iBAAiB,wCAAwC,EAChE,OAAS,CAEb,CAEQ,uBAAwB,CAC/B,KAAK,OACJ,KAAK,MAAM,iBAAiB,QAAS,IAAM,CAC1C,KAAK,gBAAA,CACN,CAAC,EAEF,KAAK,OACJ,KAAK,MAAM,iBAAiB,SAAU,IAAM,CAC3C,KAAK,gBAAA,CACN,CAAC,CACH,CAEQ,YAAa,CACpB,OAAO,KAAK,MAAM,KAAK,KAAK,OAAO,OAAS,EAAE,CAC/C,CACD,EAlFsC,6CAAtC,IAAqB,iBAArB,kBCEA,SAAS,iBAAiB,mBAAoB,IAAM,CACnD,iBACC,mCACA,aACA,iBACA,iFAAA,CAEF,CAAC,EAED,SAAS,iBACR,aACA,cACA,MACA,aACC,CACD,GAAuC,CAAC,OAAS,CAAC,aAAc,OAE5C,CAAC,GAAG,SAAS,iBAA8B,YAAY,CAAC,EAChE,QAAS,YAAe,CACnC,IAAI,iBAAiB,WAAY,MAAO,YAAY,CACrD,CAAC,EAED,MAAM,SAAW,IAAI,iBAAkB,eAAkB,CACxD,cAAc,QAAS,UAAa,CAC/B,SAAS,OAAS,aAAe,SAAS,WAAW,OAAS,GACjE,SAAS,WAAW,QAAS,WAAc,CAEzC,qBAAqB,aACrB,UAAU,aAAa,WAAW,GAClC,UAAU,aAAa,WAAW,GAAK,eAEvC,WAAW,IAAM,CAChB,IAAI,WAAa,UAAU,cAC1B,YAAA,EAEG,YACH,IAAI,iBAAiB,WAAY,MAAO,YAAY,CAEtD,EAAG,GAAI,CAET,CAAC,CAEH,CAAC,CACF,CAAC,EAEK,OAAS,CAAE,UAAW,GAAM,QAAS,EAAA,EAC3C,SAAS,QAAQ,SAAU,MAAM,CAClC,CAtCS"}