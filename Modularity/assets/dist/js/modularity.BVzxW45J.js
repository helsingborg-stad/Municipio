var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});var __publicField=(obj,key,value)=>__defNormalProp(obj,typeof key!="symbol"?key+"":key,value);$=jQuery;function Autosave(Modularity){$((function(){}).bind(this))}__name(Autosave,"Autosave");Autosave.prototype.save=function(selector){$("#modularity-options #publishing-action .spinner").css("visibility","visible");var request=$(selector).serializeObject();request.id=modularity_post_id,request.action="save_modules",$.post(ajaxurl,request,function(response){$("#modularity-options #publishing-action .spinner").css("visibility","hidden")})};jQuery.fn.serializeObject=function(){var o={},a=this.serializeArray();return jQuery.each(a,function(){o[this.name]!==void 0?(o[this.name].push||(o[this.name]=[o[this.name]]),o[this.name].push(this.value||"")):o[this.name]=this.value||""}),o};let lModularity$2=null;$=jQuery;function DragAndDrop(Modularity){lModularity$2=Modularity,$((function(){typeof pagenow<"u"&&pagenow=="admin_page_modularity-editor"&&this.init()}).bind(this))}__name(DragAndDrop,"DragAndDrop");DragAndDrop.prototype.init=function(){this.setupDraggable(),this.setupDroppable(),this.setupSortable()};DragAndDrop.prototype.setupSortable=function(){$(".modularity-js-sortable").sortable({handle:".modularity-sortable-handle",connectWith:".modularity-js-sortable",placeholder:"ui-sortable-placeholder",start:__name(function(e,ui){try{var validTargetAreas=jQuery(ui.item).attr("data-sidebar-incompability");validTargetAreas=JSON.parse(validTargetAreas),validTargetAreas&&typeof validTargetAreas=="object"&&jQuery(".modularity-sidebar-area").each(function(index,sidebar){validTargetAreas.includes(jQuery(this).attr("data-area-id"))?jQuery(this).parent().parent().addClass("modularity-incompatible-area"):jQuery(this).parent().parent().removeClass("modularity-incompatible-area")})}catch(error){console.log("Incompability information not defined - "+error)}},"start"),stop:__name(function(e,ui){var sidebarId=ui.item.parents("ul").data("area-id");ui.item.find('input[name^="modularity_modules"]').each(function(index,element){var newName=$(this).attr("name").replace(/\[(.*?)\]/i,"["+sidebarId+"]");$(this).attr("name",newName)}),jQuery("[id^=modularity-mb-]").removeClass("modularity-incompatible-area")},"stop")}).bind(this)};DragAndDrop.prototype.setupDraggable=function(){$(".modularity-js-draggable").draggable({appendTo:"body",containment:"document",scroll:!1,helper:"clone",revert:"invalid",revertDuration:200,start:__name(function(event,ui){try{var validTargetAreas=jQuery(this).attr("data-sidebar-incompability");validTargetAreas=JSON.parse(validTargetAreas),validTargetAreas&&typeof validTargetAreas=="object"&&jQuery(".modularity-sidebar-area").each(function(index,sidebar){validTargetAreas.includes(jQuery(this).attr("data-area-id"))?jQuery(this).parent().parent().addClass("modularity-incompatible-area"):jQuery(this).parent().parent().removeClass("modularity-incompatible-area")})}catch(error){console.log("Incompability information not defined - "+error)}},"start"),stop:__name(function(event,ui){jQuery("[id^=modularity-mb-]").removeClass("modularity-incompatible-area")},"stop")})};DragAndDrop.prototype.setupDroppable=function(){$(".modularity-js-droppable").droppable({accept:".modularity-js-draggable",hoverClass:"modularity-state-droppable",drop:(function(e,ui){this.appendModule(e,ui)}).bind(this)}).bind(this)};DragAndDrop.prototype.appendModule=function(e,ui){var module=ui.draggable,moduleName=module.find(".modularity-module-name").text(),moduleId=module.data("module-id"),incompability=module.attr("data-sidebar-incompability");lModularity$2.Editor.Module.addModule(e.target,moduleId,moduleName,void 0,void 0,void 0,void 0,void 0,incompability)};let lModularity$1=null;$=jQuery;let hasChangedContent=[];var thickboxOptions={is_thickbox:!0},editingModule$1=!1;function Module$1(Modularity){lModularity$1=Modularity,$((function(){typeof pagenow<"u"&&pagenow=="admin_page_modularity-editor"&&(this.handleEvents(),this.loadModules(modularity_post_id))}).bind(this))}__name(Module$1,"Module$1");Module$1.prototype.loadModules=function(postId){var pageLoadField=$('[name="modularity-option-page-loading"]'),form=pageLoadField.closest("form"),submitButton=form.find('[type="submit"]');submitButton.prop("disabled",!0);var request={action:"get_post_modules",id:postId};$.post(ajaxurl,request,(function(response){$.each(response,(function(sidebar,modules){var sidebarElement=$('.modularity-sidebar-area[data-area-id="'+sidebar+'"]');$.each(modules.modules,(function(key,data){data.hidden=="true"&&(data.hidden=!0);var incompability=typeof data.sidebar_incompability<"u"&&!$.isEmptyObject(data.sidebar_incompability)?JSON.stringify(data.sidebar_incompability):"";this.addModule(sidebarElement,data.post_type,data.post_type_name,data.post_title,data.ID,data.hidden,data.columnWidth,data.isDeprecated,incompability,data.usage??null)}).bind(this)),sidebarElement.removeClass("modularity-spinner")}).bind(this)),pageLoadField.remove(),submitButton.removeAttr("disabled"),$(".modularity-sidebar-area").removeClass("modularity-spinner")}).bind(this),"json")};Module$1.prototype.isEditingModule=()=>editingModule$1;Module$1.prototype.getThickBoxUrl=(action,data)=>{var base="",querystring={};switch(action){case"add":base="post-new.php";break;case"edit":base="post.php";break}return typeof data.postId=="number"&&(querystring.post=data.postId,querystring.action="edit"),typeof data.postType=="string"&&(querystring.post_type=data.postType),admin_url+base+"?"+$.param(querystring)+"&"+$.param(thickboxOptions)};Module$1.prototype.getImportUrl=data=>{var base="edit.php",querystring={};return querystring.post_type=data.postType,admin_url+base+"?"+$.param(querystring)+"&"+$.param(thickboxOptions)};Module$1.prototype.addModule=function(target,moduleId,moduleName,moduleTitle,postId,hidden,columnWidth,isDeprecated,incompability,usage){moduleTitle=typeof moduleTitle<"u"?": "+moduleTitle:"",postId=typeof postId<"u"?postId:"",columnWidth=typeof columnWidth<"u"?columnWidth:"";var deprecated=isDeprecated===!0?'<span class="modularity-deprecated" style="color:#ff0000;">('+modularityLang.deprecated+")</span>":"";incompability=typeof incompability<"u"?incompability:"";var thickboxUrl=this.getThickBoxUrl("add",{postType:moduleId});lModularity$1.Editor.Thickbox.postAction="add",postId&&(thickboxUrl=this.getThickBoxUrl("edit",{postId}),lModularity$1.Editor.Thickbox.postAction="edit");var importUrl=this.getImportUrl({postType:moduleId}),isHidden="";hidden===!0&&(isHidden="checked");var sidebarId=$(target).data("area-id"),itemRowId=Math.random().toString(36).substr(2,9);typeof usage=="number"&&usage>1&&(moduleTitle+=` <em>(${usage})</em>`);var html='<li id="post-'+postId+'" data-module-id="'+moduleId+'" data-module-stored-width="'+columnWidth+`" data-sidebar-incompability='`+incompability+`'>            <span class="modularity-line-wrapper">                <span class="modularity-sortable-handle">                    <i style="top:4px;" class="modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">drag_handle</i>                </span>                <span class="modularity-module-name">                    <strong>`+moduleName+"</strong>                    "+deprecated+'                    <span class="modularity-module-title">'+moduleTitle+'</span>                </span>                <span class="modularity-module-actions">                    <label class="modularity-module-columns">                        <i style="top:4px;" class="modularity-cmd-visibility-on modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">width</i>                        <select name="modularity_modules['+sidebarId+"]["+itemRowId+'][columnWidth]">                            '+modularityLang.widthOptions+'                        </select>                        <span class="label">'+modularityLang.width+'</span>                    </label>                    <label class="modularity-module-hide">                        <input type="checkbox" name="modularity_modules['+sidebarId+"]["+itemRowId+'][hidden]" value="hidden" '+isHidden+' aria-label="'+modularityLang.langhide+'"/>                        <i style="top:4px;" class="modularity-cmd-visibility-on modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">visibility</i>                        <i style="top:4px;" class="modularity-cmd-visibility-off modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">visibility_off</i>                        <span class="label">'+modularityLang.langvisibility+'</span>                    </label>                    <a href="'+thickboxUrl+'" data-modularity-modal class="modularity-js-thickbox-open modularity-err-resolver"><i style="top:3px;" class="modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">edit</i><span class="label">'+modularityLang.langedit+'</span></a>                    <a href="'+importUrl+'" class="modularity-js-thickbox-import modularity-err-resolver"><i style="top:4px;" class="modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">dataset_linked</i><span class="label">'+modularityLang.langimport+'</span></a>                    <a href="#remove" class="modularity-module-remove modularity-err-resolver"><i style="top:4px;" class="modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">delete</i><span class="label">'+modularityLang.langremove+'</span></a>                </span>                <input type="hidden" name="modularity_modules['+sidebarId+"]["+itemRowId+'][postid]" class="modularity-js-module-id" value="'+postId+'" required>                <input type="hidden" name="modularity_modules['+sidebarId+"]["+itemRowId+'][name]" value="'+moduleId+'" />            </span>        </li>';$(target).append(html),this.getAllCurrentModules(),$(".modularity-sidebar-area > li").each((index,item)=>{$(".modularity-module-columns select",$(item)).val($(item).attr("data-module-stored-width"))}),$(".modularity-js-sortable").sortable("refresh")};Module$1.prototype.getAllCurrentModules=()=>{const sliderAreas=document.querySelectorAll(".modularity-sidebar-area"),sliderAreasItemsArray=[];sliderAreas.forEach(area=>{area.querySelectorAll("li").forEach(item=>{item.hasAttribute("id")&&sliderAreasItemsArray.push(item.getAttribute("id"))})}),hasChangedContent=sliderAreasItemsArray};Module$1.prototype.updateModule=function(module,data){module.find("a.modularity-js-thickbox-open").attr("href",this.getThickBoxUrl("edit",{postId:data.post_id})),module.find("input.modularity-js-module-id").val(data.post_id).change(),module.find(".modularity-module-title").text(": "+data.title)};Module$1.prototype.removeModule=module=>{confirm(modularityLang.actionRemove)&&module.remove()};Module$1.prototype.arraysAreEqual=(a=[],b=[])=>{if(a.length!==b.length)return!1;for(let i=0;i<a.length;i++)if(a[i]!==b[i])return!1;return!0};Module$1.prototype.handleEvents=function(){let saveButtonClicked=!1;const saveButton=document.getElementById("publish");saveButton&&saveButton.addEventListener("click",()=>{saveButtonClicked=!0}),window.addEventListener("beforeunload",e=>{const modules=document.querySelectorAll(".modularity-sidebar-area > li"),arr=[];modules.forEach(element=>{element.hasAttribute("id")&&arr.push(element.getAttribute("id"))}),!saveButtonClicked&&!this.arraysAreEqual(arr,hasChangedContent)&&(e.returnValue="")}),$(document).on("click",".modularity-module-remove",(function(e){e.preventDefault();var target=$(e.target).closest("li");this.removeModule(target)}).bind(this)),$(document).on("click",".modularity-js-thickbox-import",e=>{e.preventDefault(),$(e.target).closest("a"),editingModule$1=$(e.target).closest("li"),lModularity$1.Editor.Thickbox.postAction="import",lModularity$1.Prompt.Modal.open($(e.target).closest("a").attr("href"))}),$(document).on("click",".modularity-js-thickbox-open",(e=>{e.preventDefault();var el=$(e.target).closest("a");el.attr("href").indexOf("post.php")>-1&&(lModularity$1.Editor.Thickbox.postAction="edit"),editingModule$1=$(e.target).closest("li"),lModularity$1.Prompt.Modal.open($(e.target).closest("a").attr("href"))}).bind(this))};let lModularity=null;$=jQuery;function Thickbox(Modularity){lModularity=Modularity}__name(Thickbox,"Thickbox");Thickbox.prototype.modulePostCreated=function(postId){lModularity.Prompt.Modal.close();var module=parent.Modularity.Editor.Module.isEditingModule(),request={action:"get_post",id:postId};$.post(ajaxurl,request,function(response){var data={post_id:response.ID,title:response.post_title};lModularity.Editor.Module.updateModule(module,data),lModularity.Editor.Autosave.save("form")},"json")};$=jQuery;var hasErrors=!1,errorClass="validation-error";function Validate(Modularity){this.handleEvents()}__name(Validate,"Validate");Validate.prototype.run=function(){hasErrors=!1,this.checkRequired()};Validate.prototype.checkRequired=function(){var required=$("[required]");required.removeClass(errorClass),required.each((function(index,element){$(element).val().length===0&&($(element).parents("li").addClass(errorClass),$(element).one("change",function(e){$(e.target).parents("li").removeClass(errorClass)}),hasErrors=!0)}).bind(this))};Validate.prototype.handleEvents=function(){$(document).on("click","#modularity-mb-editor-publish #publish",(function(e){return this.run(),hasErrors?($("#modularity-mb-editor-publish .spinner").css("visibility","hidden"),!1):!0}).bind(this))};$=jQuery;function Helpers(Modularity){$((function(){}).bind(this))}__name(Helpers,"Helpers");Helpers.prototype.uuid=function(separator){return Math.random().toString(36).substr(2,9)};const _Module=class _Module{constructor(id,element,restAPI){this.id=id,this.element=element,this.restAPI=restAPI,this.setupEventListeners()}setupEventListeners(){if(!this.element)throw new Error("Element is not set.");this.element.addEventListener("refresh",this.handleRefresh.bind(this)),this.element.addEventListener("DOMNodeRemoved",()=>{this.element.removeEventListener("refresh",this.handleRefresh)})}refresh(interval=null){const refreshEvent=new CustomEvent("refresh");this.element.dispatchEvent(refreshEvent),interval&&setTimeout(()=>{this.refresh(interval)},interval)}async handleRefresh(){const freshModule=await this.restAPI.getModule(this.id);this.replace(freshModule)}replace(freshModule){this.element.parentNode.replaceChild(freshModule,this.element),this.element=freshModule,this.setupEventListeners()}getRefreshInterval(){const intervalAttributeValue=this.element.getAttribute("data-module-refresh-interval");return!intervalAttributeValue||isNaN(intervalAttributeValue)?null:parseInt(intervalAttributeValue)*1e3}};__name(_Module,"Module"),__publicField(_Module,"selector","[data-module-refresh-interval]");let Module=_Module;function ensureWPApiSettings(){const{wpApiSettings}=window;if(!wpApiSettings?.root)throw new Error("wpApiSettings or wpApiSettings.root is not present on the window object.")}__name(ensureWPApiSettings,"ensureWPApiSettings");const _ModuleRefresher=class _ModuleRefresher{constructor(restAPI){this.restAPI=restAPI}refreshModules(){const moduleElements=document.querySelectorAll(Module.selector),modules=Array.from(moduleElements).map(element=>new Module(element.getAttribute("data-module-id"),element,this.restAPI));for(const module of modules){const refreshInterval=module.getRefreshInterval();module.refresh(refreshInterval)}}};__name(_ModuleRefresher,"ModuleRefresher");let ModuleRefresher=_ModuleRefresher;const ModulesRestAPIEndpoints=__name(basePath=>({getModule:`${basePath}modularity/v1/modules`}),"ModulesRestAPIEndpoints"),_ModulesRestAPI=class _ModulesRestAPI{fetcher={};endpoints={};nonce="";cacheBustKey=0;constructor(fetcher,endpoints,nonce){this.fetcher=fetcher,this.endpoints=endpoints,this.nonce=nonce,this.cacheBustKey=Math.floor(Date.now()/15e3)}async getModule(moduleID){const url=`${this.endpoints.getModule}/${moduleID}?cacheBust=${this.cacheBustKey}`,response=await this.fetcher(url);if(!response.ok)throw new Error(`Could not load module from URL: ${url}`);const htmlString=await response.json(),template=document.createElement("template");return template.innerHTML=htmlString,template.content.firstChild}};__name(_ModulesRestAPI,"ModulesRestAPI");let ModulesRestAPI=_ModulesRestAPI;var editingWidget=!1;$=jQuery;function Widget(Modularity){$((function(){$(document).on("click",".modularity-js-thickbox-widget-import-widget",function(e){e.preventDefault(),editingWidget=$(e.target).parents(".widget-inside");var importUrl=Modularity.Editor.Module.getImportUrl({postType:$(e.target).parents(".widget-inside").find(".modularity-widget-module-type select").val()});Modularity.Editor.Module.editingModule=$(e.target).closest(".widget-inside"),Modularity.Editor.Thickbox.postAction="import-widget",Modularity.Prompt.Modal.open(importUrl)}),$(document).on("click",".modularity-js-thickbox-open-widget",(function(e){e.preventDefault();var el=$(e.target).closest("a");el.attr("href").indexOf("post.php")>-1&&(Modularity.Editor.Thickbox.postAction="edit"),editingModule=$(e.target).closest("li"),Modularity.Prompt.Modal.open($(e.target).closest("a").attr("href"))}).bind(this))}).bind(this))}__name(Widget,"Widget");Widget.prototype.isEditingWidget=function(){return editingWidget};Widget.prototype.updateWidget=function(widget,data){$(widget).find(".modularity-widget-module-id-span").html(data.post_id),$(widget).find(".modularity-widget-module-id").val(data.post_id),$(widget).find(".modularity-widget-module-edit").attr("href","post.php?post="+data.post_id+"&action=edit&is_thickbox=true").removeClass("hidden"),$(widget).find(".modularity-widget-module-title-span").html(data.title),$(widget).find(".modularity-widget-module-title").val(data.title)};const _Modal=class _Modal{modalContainer;body;isOpen;constructor(){this.modalContainer=null,this.body=document.body,this.isOpen=!1,this.handleEvents()}createModalContent(url){return`
            <div class="modularity-modal-wrapper">
                <button class="modularity-modal-close" data-modularity-modal-action="close">&times; ${modularityLang?.close??modularityFrontLanguage?.close??"Close"}</button>
                <div class="modularity-modal-spinner-container" id="modularity-iframe-loader"><span class="modularity-modal-spinner"></span></div>
                <iframe class="modularity-modal-iframe" src="${url}" frameborder="0" allowtransparency></iframe>
            </div>
        `}open(url){this.modalContainer=document.createElement("div"),this.modalContainer.id="modularity-modal",this.modalContainer.innerHTML=this.createModalContent(url),this.body.appendChild(this.modalContainer),this.body.classList.add("modularity-modal-open"),this.isOpen=!0}close(){this.modalContainer&&(this.body.removeChild(this.modalContainer),this.body.classList.remove("modularity-modal-open"),this.isOpen=!1)}handleEvents(){this.body.addEventListener("click",e=>{const target=e.target;target&&target.getAttribute("data-modularity-modal-action")==="close"&&(e.preventDefault(),this.close())})}};__name(_Modal,"Modal");let Modal=_Modal;if(!parent.Modularity){var Modularity=parent.Modularity||{};Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Autosave=new Autosave,Modularity.Editor.DragAndDrop=new DragAndDrop(Modularity),Modularity.Editor.Module=new Module$1(Modularity),Modularity.Editor.Thickbox=new Thickbox(Modularity),Modularity.Editor.Validate=new Validate,Modularity.Helpers=Modularity.Helpers||{},Modularity.Helpers.Helpers=new Helpers,Modularity.Helpers.Widget=new Widget(Modularity),Modularity.Prompt=Modularity.Prompt||{},Modularity.Prompt.Modal=new Modal(Modularity),parent.Modularity=Modularity,($2=>{$2('input[type="checkbox"].sidebar-area-activator').on("click",function(e){var isChecked=$2(this).is(":checked"),value=$2(this).attr("value");e.shiftKey&&(isChecked?$2('input.sidebar-area-activator[type="checkbox"][value="'+value+'"]').attr("checked",!0):$2('input.sidebar-area-activator[type="checkbox"][value="'+value+'"]').attr("checked",!1))})})(jQuery),($2=>{$2("#modularity-options #publish").on("click",function(){$2(this).siblings(".spinner").css("visibility","visible")}),$2('a.wp-first-item[href="admin.php?page=modularity"]').parent("li").remove(),$2("#modularity-tabs a").on("click",e=>(wp.autosave&&($2(window).unbind(),wp.autosave.server.triggerSave(),$2(document).ajaxComplete(()=>!0)),!0))})(jQuery),jQuery(document).ready($2=>{if($2("#modularity-mb-modules").length){var offset=$2("#modularity-mb-modules").offset();$2(document).scroll(()=>{$2(window).scrollTop()+50>offset.top&&!$2("#modularity-mb-modules").hasClass("is-fixed")?$2("#modularity-mb-modules").addClass("is-fixed"):$2(window).scrollTop()+50<offset.top&&$2("#modularity-mb-modules").hasClass("is-fixed")&&$2("#modularity-mb-modules").removeClass("is-fixed")})}$2(".modularity-edit-module a").on("click",e=>{e.preventDefault(),Modularity.Editor.Thickbox.postAction="edit-inline-not-saved",Modularity.Prompt.Modal.open($2(e.target).closest("a").attr("href"))})})}(()=>{try{ensureWPApiSettings();const{root,nonce}=window.wpApiSettings,fetch=window.fetch.bind(window),endpoints=ModulesRestAPIEndpoints(root),restAPI=new ModulesRestAPI(fetch,endpoints,nonce);new ModuleRefresher(restAPI).refreshModules()}catch(error){console.warn(error)}})();
//# sourceMappingURL=modularity.BVzxW45J.js.map
