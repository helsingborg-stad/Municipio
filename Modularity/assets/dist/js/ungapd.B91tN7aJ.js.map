{"version":3,"file":"ungapd.B91tN7aJ.js","sources":["../../../source/php/Module/Subscribe/assets/ungapd.ts"],"sourcesContent":["interface SubscriptionInterface {\n\tContact: { Email: string };\n\tConsentText: string;\n\tListIds: string[];\n\tDoubleOptIn?: { Issue: { IssueId: string } };\n\tConfirmationIssue?: { IssueId: string };\n\tSubscriptionConfirmedUrl?: string;\n\tSubscriptionFailedUrl?: string;\n}\n\nclass Ungpd {\n\tform: HTMLElement;\n\tid: string;\n\tnotices: Node[] = [];\n\tsuccessTemplate: HTMLTemplateElement | null = null;\n\terrorTemplate: HTMLTemplateElement | null = null;\n\tconsent: HTMLInputElement;\n\temail: HTMLInputElement;\n\n\tconstructor(form: HTMLElement) {\n\t\tthis.form = form;\n\t\tthis.id = form.getAttribute(\"id\") || \"\";\n\t\tthis.email = this.form.querySelector(\n\t\t\t'input[name=\"email\"]',\n\t\t) as HTMLInputElement;\n\t\tthis.consent = this.form.querySelector(\n\t\t\t'input[name=\"user_consent\"]',\n\t\t) as HTMLInputElement;\n\t\tthis.successTemplate = document.querySelector<HTMLTemplateElement>(\n\t\t\t`template[id=\"${this.id}-success\"]`,\n\t\t);\n\t\tthis.errorTemplate = document.querySelector<HTMLTemplateElement>(\n\t\t\t`template[id=\"${this.id}-error\"]`,\n\t\t);\n\n\t\tthis.setupEventListener();\n\t}\n\n\tprivate handleSuccess() {\n\t\tconst successElement = this.successTemplate?.content.cloneNode(true);\n\t\tif (this.successTemplate?.parentNode) {\n\t\t\tthis.notices.push(\n\t\t\t\tthis.successTemplate.parentNode.appendChild(successElement!),\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate handleError(message: string | number) {\n\t\tconst errorElement = this.errorTemplate?.content.cloneNode(true);\n\t\tconst messageElement = (errorElement as HTMLElement)?.querySelector(\n\t\t\t\".message\",\n\t\t);\n\t\tif (messageElement) {\n\t\t\tmessageElement.innerHTML = message.toString();\n\t\t}\n\t\tif (this.errorTemplate?.parentNode) {\n\t\t\tthis.notices.push(\n\t\t\t\tthis.errorTemplate.parentNode.appendChild(errorElement!),\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate clearNotices() {\n\t\tthis.notices.forEach((notice) => notice.parentNode?.removeChild(notice));\n\t}\n\n\tprivate setupEventListener() {\n\t\tthis.form.addEventListener(\"submit\", this.handleFormSubmit.bind(this));\n\t}\n\n\tprivate async handleFormSubmit(event: Event) {\n\t\tevent.preventDefault();\n\t\tthis.clearNotices();\n\n\t\tconst subscription = this.subscriptionData();\n\n\t\ttry {\n\t\t\tawait this.submitSubscription(subscription);\n\t\t\tthis.handleSuccess();\n\t\t} catch (error: any) {\n\t\t\tthis.handleError(error.message);\n\t\t}\n\t}\n\n\tprivate subscriptionData() {\n\t\tconst listIds = this.form.getAttribute(\"data-js-ungpd-list-ids\");\n\t\tconst doubleOptInIssueId = this.form.getAttribute(\n\t\t\t\"data-js-ungpd-double-opt-in-issue-id\",\n\t\t);\n\t\tconst confirmationIssueId = this.form.getAttribute(\n\t\t\t\"data-js-ungpd-confirmation-issue-id\",\n\t\t);\n\t\tconst subscriptionConfirmedUrl = this.form.getAttribute(\n\t\t\t\"data-js-ungpd-subscription-confirmed-url\",\n\t\t);\n\t\tconst subscriptionFailedUrl = this.form.getAttribute(\n\t\t\t\"data-js-ungpd-subscription-failed-url\",\n\t\t);\n\n\t\tconst lists = listIds\n\t\t\t? listIds.split(\",\").map((listId) => listId.trim())\n\t\t\t: [];\n\n\t\tconst subscription: SubscriptionInterface = {\n\t\t\tContact: { Email: this.email.value },\n\t\t\tConsentText: this.consent.value,\n\t\t\tListIds: lists,\n\t\t};\n\n\t\tif (doubleOptInIssueId)\n\t\t\tsubscription.DoubleOptIn = { Issue: { IssueId: doubleOptInIssueId } };\n\t\tif (confirmationIssueId)\n\t\t\tsubscription.ConfirmationIssue = { IssueId: confirmationIssueId };\n\t\tif (subscriptionConfirmedUrl)\n\t\t\tsubscription.SubscriptionConfirmedUrl = subscriptionConfirmedUrl;\n\t\tif (subscriptionFailedUrl)\n\t\t\tsubscription.SubscriptionFailedUrl = subscriptionFailedUrl;\n\n\t\treturn subscription;\n\t}\n\n\tprivate async submitSubscription(subscription: SubscriptionInterface) {\n\t\tconst accountId = this.form.getAttribute(\"data-js-ungpd-id\");\n\n\t\tconst response = await fetch(\n\t\t\t\"https://ui.ungpd.com/Api/Subscriptions/\" + accountId,\n\t\t\t{\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(subscription),\n\t\t\t},\n\t\t);\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Failed to subscribe: ${response.status}`);\n\t\t}\n\n\t\tthis.consent.checked = false;\n\t\tthis.email.value = \"\";\n\t}\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n\tconst ungpdForms = [...document.querySelectorAll(\"[data-js-ungpd-id]\")];\n\tungpdForms.forEach((form) => {\n\t\tnew Ungpd(form as HTMLElement);\n\t});\n});\n"],"names":[],"mappings":"gHAUA,MAAM,OAAN,MAAM,MAAM,CACX,KACA,GACA,QAAkB,CAAA,EAClB,gBAA8C,KAC9C,cAA4C,KAC5C,QACA,MAEA,YAAY,KAAmB,CAC9B,KAAK,KAAO,KACZ,KAAK,GAAK,KAAK,aAAa,IAAI,GAAK,GACrC,KAAK,MAAQ,KAAK,KAAK,cACtB,qBAAA,EAED,KAAK,QAAU,KAAK,KAAK,cACxB,4BAAA,EAED,KAAK,gBAAkB,SAAS,cAC/B,gBAAgB,KAAK,EAAE,YAAA,EAExB,KAAK,cAAgB,SAAS,cAC7B,gBAAgB,KAAK,EAAE,UAAA,EAGxB,KAAK,mBAAA,CACN,CAEQ,eAAgB,CACvB,MAAM,eAAiB,KAAK,iBAAiB,QAAQ,UAAU,EAAI,EAC/D,KAAK,iBAAiB,YACzB,KAAK,QAAQ,KACZ,KAAK,gBAAgB,WAAW,YAAY,cAAe,CAAA,CAG9D,CAEQ,YAAY,QAA0B,CAC7C,MAAM,aAAe,KAAK,eAAe,QAAQ,UAAU,EAAI,EACzD,eAAkB,cAA8B,cACrD,UAAA,EAEG,iBACH,eAAe,UAAY,QAAQ,SAAA,GAEhC,KAAK,eAAe,YACvB,KAAK,QAAQ,KACZ,KAAK,cAAc,WAAW,YAAY,YAAa,CAAA,CAG1D,CAEQ,cAAe,CACtB,KAAK,QAAQ,QAAS,QAAW,OAAO,YAAY,YAAY,MAAM,CAAC,CACxE,CAEQ,oBAAqB,CAC5B,KAAK,KAAK,iBAAiB,SAAU,KAAK,iBAAiB,KAAK,IAAI,CAAC,CACtE,CAEA,MAAc,iBAAiB,MAAc,CAC5C,MAAM,eAAA,EACN,KAAK,aAAA,EAEL,MAAM,aAAe,KAAK,iBAAA,EAE1B,GAAI,CACH,MAAM,KAAK,mBAAmB,YAAY,EAC1C,KAAK,cAAA,CACN,OAAS,MAAY,CACpB,KAAK,YAAY,MAAM,OAAO,CAC/B,CACD,CAEQ,kBAAmB,CAC1B,MAAM,QAAU,KAAK,KAAK,aAAa,wBAAwB,EACzD,mBAAqB,KAAK,KAAK,aACpC,sCAAA,EAEK,oBAAsB,KAAK,KAAK,aACrC,qCAAA,EAEK,yBAA2B,KAAK,KAAK,aAC1C,0CAAA,EAEK,sBAAwB,KAAK,KAAK,aACvC,uCAAA,EAGK,MAAQ,QACX,QAAQ,MAAM,GAAG,EAAE,IAAK,QAAW,OAAO,KAAA,CAAM,EAChD,CAAA,EAEG,aAAsC,CAC3C,QAAS,CAAE,MAAO,KAAK,MAAM,KAAA,EAC7B,YAAa,KAAK,QAAQ,MAC1B,QAAS,KAAA,EAGV,OAAI,qBACH,aAAa,YAAc,CAAE,MAAO,CAAE,QAAS,mBAAmB,GAC/D,sBACH,aAAa,kBAAoB,CAAE,QAAS,mBAAA,GACzC,2BACH,aAAa,yBAA2B,0BACrC,wBACH,aAAa,sBAAwB,uBAE/B,YACR,CAEA,MAAc,mBAAmB,aAAqC,CACrE,MAAM,UAAY,KAAK,KAAK,aAAa,kBAAkB,EAErD,SAAW,MAAM,MACtB,0CAA4C,UAC5C,CACC,OAAQ,OACR,QAAS,CACR,eAAgB,kBAAA,EAEjB,KAAM,KAAK,UAAU,YAAY,CAAA,CAClC,EAGD,GAAI,CAAC,SAAS,GACb,MAAM,IAAI,MAAM,wBAAwB,SAAS,MAAM,EAAE,EAG1D,KAAK,QAAQ,QAAU,GACvB,KAAK,MAAM,MAAQ,EACpB,CACD,EApIY,uBAAZ,IAAM,MAAN,OAsIA,SAAS,iBAAiB,mBAAoB,IAAM,CAChC,CAAC,GAAG,SAAS,iBAAiB,oBAAoB,CAAC,EAC3D,QAAS,MAAS,CAC5B,IAAI,MAAM,IAAmB,CAC9B,CAAC,CACF,CAAC"}