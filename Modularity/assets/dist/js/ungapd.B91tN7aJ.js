var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});const _Ungpd=class _Ungpd{form;id;notices=[];successTemplate=null;errorTemplate=null;consent;email;constructor(form){this.form=form,this.id=form.getAttribute("id")||"",this.email=this.form.querySelector('input[name="email"]'),this.consent=this.form.querySelector('input[name="user_consent"]'),this.successTemplate=document.querySelector(`template[id="${this.id}-success"]`),this.errorTemplate=document.querySelector(`template[id="${this.id}-error"]`),this.setupEventListener()}handleSuccess(){const successElement=this.successTemplate?.content.cloneNode(!0);this.successTemplate?.parentNode&&this.notices.push(this.successTemplate.parentNode.appendChild(successElement))}handleError(message){const errorElement=this.errorTemplate?.content.cloneNode(!0),messageElement=errorElement?.querySelector(".message");messageElement&&(messageElement.innerHTML=message.toString()),this.errorTemplate?.parentNode&&this.notices.push(this.errorTemplate.parentNode.appendChild(errorElement))}clearNotices(){this.notices.forEach(notice=>notice.parentNode?.removeChild(notice))}setupEventListener(){this.form.addEventListener("submit",this.handleFormSubmit.bind(this))}async handleFormSubmit(event){event.preventDefault(),this.clearNotices();const subscription=this.subscriptionData();try{await this.submitSubscription(subscription),this.handleSuccess()}catch(error){this.handleError(error.message)}}subscriptionData(){const listIds=this.form.getAttribute("data-js-ungpd-list-ids"),doubleOptInIssueId=this.form.getAttribute("data-js-ungpd-double-opt-in-issue-id"),confirmationIssueId=this.form.getAttribute("data-js-ungpd-confirmation-issue-id"),subscriptionConfirmedUrl=this.form.getAttribute("data-js-ungpd-subscription-confirmed-url"),subscriptionFailedUrl=this.form.getAttribute("data-js-ungpd-subscription-failed-url"),lists=listIds?listIds.split(",").map(listId=>listId.trim()):[],subscription={Contact:{Email:this.email.value},ConsentText:this.consent.value,ListIds:lists};return doubleOptInIssueId&&(subscription.DoubleOptIn={Issue:{IssueId:doubleOptInIssueId}}),confirmationIssueId&&(subscription.ConfirmationIssue={IssueId:confirmationIssueId}),subscriptionConfirmedUrl&&(subscription.SubscriptionConfirmedUrl=subscriptionConfirmedUrl),subscriptionFailedUrl&&(subscription.SubscriptionFailedUrl=subscriptionFailedUrl),subscription}async submitSubscription(subscription){const accountId=this.form.getAttribute("data-js-ungpd-id"),response=await fetch("https://ui.ungpd.com/Api/Subscriptions/"+accountId,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(subscription)});if(!response.ok)throw new Error(`Failed to subscribe: ${response.status}`);this.consent.checked=!1,this.email.value=""}};__name(_Ungpd,"Ungpd");let Ungpd=_Ungpd;document.addEventListener("DOMContentLoaded",()=>{[...document.querySelectorAll("[data-js-ungpd-id]")].forEach(form=>{new Ungpd(form)})});
//# sourceMappingURL=ungapd.B91tN7aJ.js.map
