var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});function taxonomiesRequest(data,taxonomySelect,taxonomySpinner){return new Promise(resolve=>{const xhr=new XMLHttpRequest;xhr.open("POST",ajaxurl,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.onreadystatechange=()=>{if(xhr.readyState===4){if(xhr.status!==200){resolve(!1);return}const response=JSON.parse(xhr.responseText);if(!response.types||response.types.length<=0){taxonomySpinner?.remove();return}Object.keys(response.types).forEach(key=>{const taxonomy=response.types[key],isSelected=getSelected([response.curr,data.selected],taxonomy.name)?"selected":"";taxonomySelect.insertAdjacentHTML("beforeend",`<option value="${taxonomy.name}" ${isSelected}>${taxonomy.label}</option>`)}),taxonomySpinner?.remove(),resolve(!0)}};const urlEncodedData=Object.keys(data).map(key=>encodeURIComponent(key)+"="+encodeURIComponent(data[key])).join("&");xhr.send(urlEncodedData)})}__name(taxonomiesRequest,"taxonomiesRequest");function termsRequest(data,termsSelect,termsSpinner){const xhr=new XMLHttpRequest;xhr.open("POST",ajaxurl,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.onreadystatechange=()=>{if(xhr.readyState===4&&xhr.status===200){const response=JSON.parse(xhr.responseText);if(!response.tax||response.tax.length<=0){termsSpinner?.remove();return}Object.keys(response.tax).forEach(key=>{const term=response.tax[key],isSelected=getSelected([response.curr,data.selected],term.slug)?"selected":"";termsSelect.insertAdjacentHTML("beforeend",`<option value="${term.slug}" ${isSelected}>${term.name}</option>`)}),termsSpinner?.remove()}};const urlEncodedData=Object.keys(data).map(key=>encodeURIComponent(key)+"="+encodeURIComponent(data[key])).join("&");xhr.send(urlEncodedData)}__name(termsRequest,"termsRequest");function getSelected(checks,value){for(const check of checks)if(check?.replace(/[\n\s]/g,"")===value)return!0;return!1}__name(getSelected,"getSelected");const _Filter=class _Filter{constructor(postId,filterElements,blockSelectedValues=null){this.postId=postId,this.filterElements=filterElements,this.blockSelectedValues=blockSelectedValues,this.taxonomySpinner=null,this.termsSpinner=null}taxonomySpinner;termsSpinner;initializeTaxonomyFilter(){this.updateTaxonomiesAndTerms(),this.setupChangeListeners()}setupChangeListeners(){this.filterElements.postTypeSelect.addEventListener("change",()=>{this.updateTaxonomiesAndTerms()}),this.filterElements.taxonomySelect.addEventListener("change",()=>{this.updateTerms()})}updateTaxonomiesAndTerms(){this.removeExistingData(this.filterElements.taxonomySelect),this.addSpinner(this.filterElements.taxonomySelectLabel,"taxonomySpinner"),taxonomiesRequest({action:"get_taxonomy_types_v2",posttype:this.filterElements.postTypeSelect.value,post:this.postId,selected:this.blockSelectedValues?this.blockSelectedValues.selectedTaxonomy:null},this.filterElements.taxonomySelect,this.taxonomySpinner).then(response=>{this.updateTerms(response)})}updateTerms(response=!0){this.removeExistingData(this.filterElements.termsSelect),this.addSpinner(this.filterElements.termsSelectLabel,"termsSpinner"),response&&termsRequest({action:"get_taxonomy_values_v2",tax:this.filterElements.taxonomySelect.value,selected:this.blockSelectedValues?this.blockSelectedValues.selectedTerm:null,post:this.postId},this.filterElements.termsSelect,this.termsSpinner)}addSpinner(element,type){element.insertAdjacentHTML("afterbegin",'<span class="spinner" style="visibility: visible; float: none; margin: 0 5px 0 0;"></span>'),this[type]=element.querySelector(".spinner")}removeExistingData(element){for(;element.firstChild;)element.removeChild(element.firstChild)}};__name(_Filter,"Filter");let Filter=_Filter;const _ModuleFilteringSetup=class _ModuleFilteringSetup{constructor(postId){this.postId=postId,this.filterContainerSelector="#acf-group_571e045dd555d",this.handleFilteringElements()}filterContainerSelector="";handleFilteringElements(){const filterContainerElement=document.querySelector(this.filterContainerSelector),group=filterContainerElement?.closest(".postbox-container"),taxonomySelect=filterContainerElement?.querySelector(".modularity-latest-taxonomy select"),termsSelect=filterContainerElement?.querySelector(".modularity-latest-taxonomy-value select"),taxonomySelectLabel=filterContainerElement?.querySelector(".modularity-latest-taxonomy .acf-label label"),termsSelectLabel=filterContainerElement?.querySelector(".modularity-latest-taxonomy-value .acf-label label"),postTypeSelect=group?.querySelector(".modularity-latest-post-type select");if(!postTypeSelect||!taxonomySelect||!taxonomySelectLabel||!termsSelect||!termsSelectLabel)return;new Filter(this.postId,{container:filterContainerElement,postTypeSelect,taxonomySelect,taxonomySelectLabel,termsSelect,termsSelectLabel}).initializeTaxonomyFilter()}};__name(_ModuleFilteringSetup,"ModuleFilteringSetup");let ModuleFilteringSetup=_ModuleFilteringSetup;const _BlockFilteringSetup=class _BlockFilteringSetup{constructor(postId){this.postId=postId,this.initializedPostsBlocks=[],this.listenForBlocks()}initializedPostsBlocks;postTypeSelectFieldKey="571dfc40f8114";taxonomySelectFieldKey="571e048136f10";termsSelectFieldKey="571e049636f11";sidebarId="edit-post:block";listenForBlocks(){const editor=wp.data.select("core/block-editor");let timeoutId;wp.data.subscribe(()=>{timeoutId&&clearTimeout(timeoutId),timeoutId=window.setTimeout(()=>{const postsBlockIds=editor.getBlocksByName("acf/posts");postsBlockIds.length>0&&postsBlockIds.forEach(postBlockId=>{this.setupBlockTaxonomyFiltering(postBlockId,editor)})},300)})}setupBlockTaxonomyFiltering(postBlockId,editor){if(!this.initializedPostsBlocks.includes(postBlockId)){this.initializedPostsBlocks.push(postBlockId);const block=editor.getBlock(postBlockId),intervalId=setInterval(()=>{const filterElements=this.getFilterElements(block);filterElements&&(this.taxonomyFilteringBlockInitialization(block,filterElements),clearInterval(intervalId))},1e3)}}taxonomyFilteringBlockInitialization(block,filterElements){const selectedTaxonomy=block.attributes?.data?.posts_taxonomy_type?block.attributes.data.posts_taxonomy_type:null,selectedTerm=block.attributes?.data?.posts_taxonomy_value?block.attributes.data.posts_taxonomy_value:null;new Filter(this.postId,filterElements,{selectedTaxonomy,selectedTerm}).initializeTaxonomyFilter()}getFilterElements(block){const filterContainerElement=document.querySelector("#block-"+block.clientId),sidebar=document.getElementById(this.sidebarId),{taxonomySelect,taxonomySelectLabel}=this.getTaxonomyElements(block,sidebar,filterContainerElement),{termsSelect,termsSelectLabel}=this.getTermsElements(block,sidebar,filterContainerElement),postTypeSelect=this.getPostTypeElement(block,sidebar,filterContainerElement);return!postTypeSelect||!taxonomySelect||!taxonomySelectLabel||!termsSelect||!termsSelectLabel?null:{container:filterContainerElement,postTypeSelect,taxonomySelect,taxonomySelectLabel,termsSelect,termsSelectLabel}}getTaxonomyElements(block,sidebar,filterContainerElement){const taxonomySelect=filterContainerElement?.querySelector(`[data-key="field_${this.taxonomySelectFieldKey}"] select`)||sidebar?.querySelector(`#acf-block_${block.clientId}-field_${this.taxonomySelectFieldKey}`)||sidebar?.querySelector(`#acf-${block.clientId}-field_${this.taxonomySelectFieldKey}`),taxonomySelectLabel=filterContainerElement?.querySelector(`[data-key="field_${this.taxonomySelectFieldKey}"] .acf-label label`)||sidebar?.querySelector(`label[for="acf-block_${block.clientId}-field_${this.taxonomySelectFieldKey}"`)||sidebar?.querySelector(`label[for="acf-${block.clientId}-field_${this.taxonomySelectFieldKey}"`);return{taxonomySelect,taxonomySelectLabel}}getTermsElements(block,sidebar,filterContainerElement){const termsSelect=filterContainerElement?.querySelector(`[data-key="field_${this.termsSelectFieldKey}"] select`)||sidebar?.querySelector(`#acf-block_${block.clientId}-field_${this.termsSelectFieldKey}`)||sidebar?.querySelector(`#acf-${block.clientId}-field_${this.termsSelectFieldKey}`),termsSelectLabel=filterContainerElement?.querySelector(`[data-key="field_${this.termsSelectFieldKey}"] .acf-label label`)||sidebar?.querySelector(`label[for="acf-block_${block.clientId}-field_${this.termsSelectFieldKey}"`)||sidebar?.querySelector(`label[for="acf-${block.clientId}-field_${this.termsSelectFieldKey}"`);return{termsSelect,termsSelectLabel}}getPostTypeElement(block,sidebar,filterContainerElement){return filterContainerElement?.querySelector(`[data-key="field_${this.postTypeSelectFieldKey}"] select`)||sidebar?.querySelector(`#acf-block_${block.clientId}-field_${this.postTypeSelectFieldKey}`)||sidebar?.querySelector(`#acf-${block.clientId}-field_${this.postTypeSelectFieldKey}`)}};__name(_BlockFilteringSetup,"BlockFilteringSetup");let BlockFilteringSetup=_BlockFilteringSetup;document.addEventListener("DOMContentLoaded",()=>{!modPostsTaxonomyFiltering||!modPostsTaxonomyFiltering.currentPostID||(pagenow==="mod-posts"&&new ModuleFilteringSetup(modPostsTaxonomyFiltering.currentPostID),typeof wp<"u"&&wp.blocks&&new BlockFilteringSetup(modPostsTaxonomyFiltering.currentPostID))});
//# sourceMappingURL=mod-posts-taxonomy-filtering.Diydqm_i.js.map
