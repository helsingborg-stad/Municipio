{"version":3,"file":"newEndpoint.C_IL8L5Q.js","sources":["../source/js/restApi/newEndpoint.ts"],"sourcesContent":["export enum NameSpace {\n    MUNICIPIO_V1 = 'municipio/v1',\n}\n\ntype RequestMethod = 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n\ninterface EndpointOptions {\n    nameSpace: NameSpace;\n    route: string;\n    method: RequestMethod;\n}\n\nexport interface ApiCallArgs extends Record<string,any> {\n    routeParams?: string\n}\n\nconst getNonce = ():string|null => {\n    if( typeof wpApiSettings === 'undefined' || !wpApiSettings.nonce ) {\n        return null\n    }\n    \n    return wpApiSettings.nonce\n}\n\nconst getApiRoot = ():string|null => {\n    if( typeof wpApiSettings === 'undefined' || !wpApiSettings.root ) {\n        return null\n    }\n    \n    return wpApiSettings.root\n}\n\nconst buildUrl = (nameSpace:string, route:string, routeParams?:string, params?:{}):string => {\n\n    const apiRoot = getApiRoot()\n\n    if( !apiRoot ) {\n        return ''\n    }\n\n    let url = `${apiRoot}${nameSpace}/${route}`\n    url += routeParams ? `/${routeParams}` : ''\n\n    if (params) {\n        const searchParams = new URLSearchParams();\n        Object.entries(params).forEach(([key, value]) => {\n            if (Array.isArray(value)) {\n                value.forEach(v => searchParams.append(key, String(v)));\n            } else if (value !== null && value !== undefined) {\n                searchParams.append(key, String(value));\n            }\n        });\n        const queryString = searchParams.toString();\n        url += queryString ? '?' + queryString : '';\n    }\n\n    return url\n}\n\nexport const newEndpoint = <T, A extends ApiCallArgs>(options:EndpointOptions) => ({\n    call: (callArgs?:A):Promise<T> => {\n        \n        const {routeParams, ...data} = callArgs ?? {}\n        const url = buildUrl(options.nameSpace,options.route,routeParams,options.method === 'GET' && data)\n        const nonce = getNonce()\n        \n        const headers:HeadersInit = {\n            'Content-Type': 'application/json',\n        }\n        \n        if( nonce ) {\n            headers['X-WP-Nonce'] = nonce\n        }\n\n        const fetchOptions:RequestInit = {\n            method: options.method,\n            headers\n        }\n\n        if( options.method !== 'GET' ) {\n            fetchOptions.body = JSON.stringify(callArgs)\n        }\n        \n        return fetch(\n            url,\n            {\n                method: options.method,\n                body: options.method !== 'GET' ? JSON.stringify(callArgs) : undefined,\n                headers\n            }\n            ).then(response => {\n                if(response.status === 200) {\n                    const contentType = response.headers.get(\"content-type\");\n                    const contentTypeIsJson = (contentType && contentType.indexOf(\"application/json\") !== -1)\n                    \n                    if(contentTypeIsJson) {\n                        return response.json()\n                    }\n                    \n                    return response.text();\n                } else {\n                    return response.statusText;\n                }\n            });\n        },\n    });\n    "],"names":["NameSpace"],"mappings":"gHAAO,IAAK,WAAAA,aACRA,WAAA,aAAe,eADPA,aAAA,WAAA,CAAA,CAAA,EAgBZ,MAAM,SAAW,WACT,OAAO,cAAkB,KAAe,CAAC,cAAc,MAChD,KAGJ,cAAc,MALR,YAQX,WAAa,WACX,OAAO,cAAkB,KAAe,CAAC,cAAc,KAChD,KAGJ,cAAc,KALN,cAQb,SAAW,QAAC,UAAkB,MAAc,YAAqB,SAAsB,CAEzF,MAAM,QAAU,WAAA,EAEhB,GAAI,CAAC,QACD,MAAO,GAGX,IAAI,IAAM,GAAG,OAAO,GAAG,SAAS,IAAI,KAAK,GAGzC,GAFA,KAAO,YAAc,IAAI,WAAW,GAAK,GAErC,OAAQ,CACR,MAAM,aAAe,IAAI,gBACzB,OAAO,QAAQ,MAAM,EAAE,QAAQ,CAAC,CAAC,IAAK,KAAK,IAAM,CACzC,MAAM,QAAQ,KAAK,EACnB,MAAM,WAAa,aAAa,OAAO,IAAK,OAAO,CAAC,CAAC,CAAC,EAC/C,OAAU,MACjB,aAAa,OAAO,IAAK,OAAO,KAAK,CAAC,CAE9C,CAAC,EACD,MAAM,YAAc,aAAa,SAAA,EACjC,KAAO,YAAc,IAAM,YAAc,EAC7C,CAEA,OAAO,GACX,EAzBiB,YA2BJ,YAAc,OAA2B,UAA6B,CAC/E,KAAM,OAAC,UAA2B,CAE9B,KAAM,CAAC,YAAa,GAAG,IAAA,EAAQ,UAAY,CAAA,EACrC,IAAM,SAAS,QAAQ,UAAU,QAAQ,MAAM,YAAY,QAAQ,SAAW,OAAS,IAAI,EAC3F,MAAQ,SAAA,EAER,QAAsB,CACxB,eAAgB,kBAAA,EAGpB,OAAI,QACA,QAAQ,YAAY,EAAI,OAIhB,QAAQ,OAIhB,QAAQ,SAAW,OACC,KAAK,UAAU,QAAQ,EAGxC,MACH,IACA,CACI,OAAQ,QAAQ,OAChB,KAAM,QAAQ,SAAW,MAAQ,KAAK,UAAU,QAAQ,EAAI,OAC5D,OAAA,CACJ,EACE,KAAK,UAAY,CACf,GAAG,SAAS,SAAW,IAAK,CACxB,MAAM,YAAc,SAAS,QAAQ,IAAI,cAAc,EAGvD,OAF2B,aAAe,YAAY,QAAQ,kBAAkB,IAAM,GAG3E,SAAS,KAAA,EAGb,SAAS,KAAA,CACpB,KACI,QAAO,SAAS,UAExB,CAAC,CACL,EA5CE,OA6CN,GA9CuB"}