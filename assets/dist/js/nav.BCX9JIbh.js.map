{"version":3,"file":"nav.BCX9JIbh.js","sources":["../../source/js/restApi/endpoints/viewRender.ts","../../source/js/nav.ts"],"sourcesContent":["import {newEndpoint, NameSpace, ApiCallArgs } from \"../newEndpoint\";\n\nexport interface ViewRenderArgs extends ApiCallArgs {\n    routeParams: string\n    data?: {}\n}\n\nexport const viewRender = newEndpoint<string, ViewRenderArgs>({\n    nameSpace: NameSpace.MUNICIPIO_V1,\n    route: 'view/render',\n    method: 'GET'\n});\n","import { viewRender } from \"./restApi/endpoints/viewRender\";\n\nconst SELECTOR_TOGGLE_BUTTON = \".js-async-children\";\nconst ATTRIBUTE_FETCH_URL = \"data-fetch-url\";\nlet placeholderMarkup: HTMLElement | null = null;\n\ndeclare const wpApiSettings: {\n\tnonce: any;\n};\n\nconst fetchMarkup = async (\n\turl: string,\n\tuseNonce: boolean = true,\n): Promise<string> => {\n\tconst headers: Record<string, string> = {\n\t\t\"content-type\": \"application/json\",\n\t};\n\n\tif (useNonce) {\n\t\theaders[\"X-WP-Nonce\"] = wpApiSettings?.nonce;\n\t}\n\n\ttry {\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: \"GET\",\n\t\t\tcredentials: \"include\",\n\t\t\theaders: headers,\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tif (useNonce) {\n\t\t\t\treturn fetchMarkup(url, false);\n\t\t\t}\n\t\t\tthrow new Error(`Fetch failed with status: ${response.status}`);\n\t\t}\n\n\t\tconst { markup } = await response.json();\n\t\treturn markup;\n\t} catch (error) {\n\t\tif (useNonce) {\n\t\t\treturn fetchMarkup(url, false);\n\t\t}\n\t\tthrow error;\n\t}\n};\n\nfunction stringToHTML(str: string): HTMLElement {\n\tconst parser = new DOMParser();\n\tconst htmlDoc = parser.parseFromString(str, \"text/html\");\n\treturn htmlDoc.body.firstChild as HTMLElement;\n}\n\nconst getPlaceholderMarkup = async (): Promise<HTMLElement | null> => {\n\treturn viewRender\n\t\t.call({ routeParams: \"partials/preloader\" })\n\t\t.then((htmlString) => {\n\t\t\treturn stringToHTML(htmlString);\n\t\t})\n\t\t.catch((error) => {\n\t\t\tconsole.error(error.message);\n\t\t\treturn null;\n\t\t});\n};\n\nconst appendPlaceholder = async (placementElement: Element) => {\n\tif (placeholderMarkup === null) return;\n\tconst clone = placeholderMarkup.cloneNode(true) as HTMLElement;\n\tplacementElement.insertAdjacentElement(\"beforeend\", clone);\n};\n\nconst removePlaceholder = (placementElement: Element) => {\n\tconst placeholder = placementElement.querySelector(\".preloader\");\n\n\tif (placeholder === null) {\n\t\treturn;\n\t}\n\n\tplaceholder.remove();\n};\n\nconst insertSubMenu = (placementElement: Element, markup: string) => {\n\tplacementElement.insertAdjacentHTML(\"beforeend\", markup);\n};\n\nconst subscribeOnClick = (element: Element) => {\n\tconst handleClick = () => {\n\t\t// Parent of toggle has all states\n\t\tconst parentElement = element.closest(\".js-async-children-data\");\n\n\t\tif (parentElement === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst parentClassNames = [...parentElement.classList];\n\n\t\t// States\n\t\tconst hasFetched = parentClassNames.includes(\"has-fetched\");\n\t\tconst isFetching = parentClassNames.includes(\"is-fetching\");\n\n\t\t// Bye\n\t\tif (isFetching || hasFetched) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Input from attributes\n\t\tconst fetchUrl = parentElement.getAttribute(ATTRIBUTE_FETCH_URL);\n\n\t\tif (!fetchUrl) {\n\t\t\tconsole.error(\"Fetch URL is not defined.\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst customPlacement = parentElement.querySelector(\n\t\t\t\"[data-js-async-children]\",\n\t\t);\n\t\tconst placement =\n\t\t\tcustomPlacement && customPlacement.parentElement\n\t\t\t\t? customPlacement.parentElement\n\t\t\t\t: parentElement;\n\n\t\t// Set states before fetching\n\t\tappendPlaceholder(placement);\n\t\tparentElement.classList.add(\"is-fetching\");\n\t\tparentElement.classList.add(\"is-loading\");\n\n\t\tfetchMarkup(fetchUrl)\n\t\t\t.then((markup) => {\n\t\t\t\t// Remove placeholder\n\t\t\t\tremovePlaceholder(placement);\n\n\t\t\t\t// Render sub-menu\n\t\t\t\tinsertSubMenu(placement, markup);\n\n\t\t\t\t// Make sure submenu is rendered before removing it from DOM\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tcustomPlacement?.remove();\n\t\t\t\t});\n\n\t\t\t\t// Set states\n\t\t\t\tparentElement.classList.remove(\"is-fetching\");\n\t\t\t\tparentElement.classList.remove(\"is-loading\");\n\t\t\t\tparentElement.classList.add(\"has-fetched\");\n\n\t\t\t\t// Subscribe new toggles found in sub-menu recursively\n\t\t\t\tconst newSubMenu = parentElement.lastElementChild;\n\t\t\t\tif (newSubMenu) {\n\t\t\t\t\tconst newToggleButtons = newSubMenu.querySelectorAll(\n\t\t\t\t\t\tSELECTOR_TOGGLE_BUTTON,\n\t\t\t\t\t);\n\t\t\t\t\tif (newToggleButtons && newToggleButtons.length > 0) {\n\t\t\t\t\t\tnewToggleButtons.forEach(subscribeOnClick);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tconsole.error(e);\n\t\t\t\t// Reset states\n\t\t\t\tparentElement.classList.remove(\"is-fetching\");\n\t\t\t\tparentElement.classList.remove(\"is-loading\");\n\t\t\t});\n\t};\n\n\telement.addEventListener(\"click\", handleClick);\n};\n\n/**\n * If the top level domain of the current URL is `translate.goog`, then return `true`, otherwise return\n * `false`\n * @returns A boolean value.\n */\nfunction isCurrentlyBeingTranslated() {\n\tconst hostChunks = window.location.hostname.split(\".\");\n\tconst hostTop =\n\t\thostChunks[hostChunks.length - 2] + \".\" + hostChunks[hostChunks.length - 1];\n\n\treturn \"translate.goog\" === hostTop;\n}\n\nconst init = async () => {\n\t/*\n\t * Hide language menu if the site is loaded with translate.goog as top level domain\n\t * to prevent google translate from opening multiple sites within.\n\t */\n\n\tif (isCurrentlyBeingTranslated()) {\n\t\tconst languageMenu = document.getElementsByClassName(\"site-language-menu\");\n\t\tif (languageMenu.length > 0) {\n\t\t\t[...languageMenu].forEach((element) => {\n\t\t\t\telement.remove();\n\t\t\t});\n\t\t}\n\t}\n\n\tconst toggleButtons = document.querySelectorAll(SELECTOR_TOGGLE_BUTTON);\n\tplaceholderMarkup = await getPlaceholderMarkup();\n\n\tif (toggleButtons && toggleButtons.length > 0) {\n\t\ttoggleButtons.forEach(subscribeOnClick);\n\t}\n};\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n\tinit();\n});\n"],"names":[],"mappings":"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"}