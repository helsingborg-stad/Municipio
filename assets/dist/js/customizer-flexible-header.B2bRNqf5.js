var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});const _HiddenSetting=class _HiddenSetting{constructor(hiddenSettingSavedValue,hiddenName,kirkiAttributeName){this.hiddenSettingSavedValue=hiddenSettingSavedValue,this.hiddenName=hiddenName,this.kirkiAttributeName=kirkiAttributeName,this.getHiddenSettingField()&&(this.getHiddenSettingField().style.display="none"),this.hiddenField=null}hiddenField;getHiddenSettingField(){return this.hiddenField?this.hiddenField:(this.hiddenField=document.querySelector(`[${this.kirkiAttributeName}="${this.hiddenName}"]`),this.hiddenField)}setHiddenFieldValue(value){wp.customize(this.hiddenName,setting=>{setting.set(JSON.stringify(value))})}getHiddenFieldValue(){let localHiddenSettingSavedValue=this.hiddenSettingSavedValue;if(!localHiddenSettingSavedValue||typeof localHiddenSettingSavedValue!="string")return{};try{return JSON.parse(localHiddenSettingSavedValue)}catch(e){console.error("Could not parse field value: ",e)}return{}}};__name(_HiddenSetting,"HiddenSetting");let HiddenSetting=_HiddenSetting;function getMenuIconHtml(){return'<i class="dashicons dashicons-edit" style="float:right;margin-right:4px;cursor:pointer;" data-js-sortable-edit></i>'}__name(getMenuIconHtml,"getMenuIconHtml");function getDropdownHtml(settings,translations){return`
        <div class="flexible-header-edit" data-js-flexible-dropdown>
            <div class="flexible-header-settings">
                <h3>${translations.alignment??"Alignment"}</h3>
                <select data-js-flexible-setting="align">
                    <option value="left" ${settings.align==="left"?"selected":""}>${translations.left??"Left"}</option>
                    <option value="center" ${settings.align==="center"?"selected":""}>${translations.center??"Center"}</option>
                    <option value="right" ${settings.align==="right"?"selected":""}>${translations.right??"Right"}</option>
                </select>

                <h3>${translations.margin??"Margin"}</h3>
                <select data-js-flexible-setting="margin">
                    <option value="none" ${settings.margin==="none"?"selected":""}>${translations.none??"None"}</option>
                    <option value="both" ${settings.margin==="both"?"selected":""}>${translations.both??"Both"}</option>
                    <option value="left" ${settings.margin==="left"?"selected":""}>${translations.left??"Left"}</option>
                    <option value="right" ${settings.margin==="right"?"selected":""}>${translations.right??"Right"}</option>
                </select>
            </div>
        </div>
    `}__name(getDropdownHtml,"getDropdownHtml");function addEditIconToSortables(setting){const menuIcons=setting.querySelectorAll(".dashicons.dashicons-menu");menuIcons&&menuIcons.length>0&&[...menuIcons].forEach(menuIcon=>{menuIcon.insertAdjacentHTML("afterend",getMenuIconHtml())})}__name(addEditIconToSortables,"addEditIconToSortables");function getSettingsKeys(){return{flexibleAreaNames:["header_sortable_section_main_upper","header_sortable_section_main_lower"],hiddenName:"header_sortable_hidden_storage",responsiveNameKey:"_responsive",kirkiAttributeName:"data-kirki-setting"}}__name(getSettingsKeys,"getSettingsKeys");const _GetSortableItems=class _GetSortableItems{constructor(setting,responsiveSetting){this.setting=setting,this.responsiveSetting=responsiveSetting,this.sortableItems=this.getSortableItems(),this.sortableResponsiveItems=this.getSortableResponsiveItems()}sortableItems;sortableResponsiveItems;getSortableItems(){return this.sortableItems&&this.sortableItems.length>0?this.sortableItems:(this.sortableItems=[...this.setting.querySelectorAll(".kirki-sortable-item")],this.sortableItems)}getSortableResponsiveItems(){return this.sortableResponsiveItems&&this.sortableResponsiveItems.length>0?this.sortableResponsiveItems:(this.sortableResponsiveItems=[...this.responsiveSetting.querySelectorAll(".kirki-sortable-item")],this.sortableResponsiveItems)}};__name(_GetSortableItems,"GetSortableItems");let GetSortableItems=_GetSortableItems;const defaultEditValues={align:"right",margin:"none"},_Edit=class _Edit{constructor(storageInstance,dropdownElement,settingsElements,editButton,settings,defaultSettings,sortableItemKey,areaKey,sortableItem){this.storageInstance=storageInstance,this.dropdownElement=dropdownElement,this.settingsElements=settingsElements,this.editButton=editButton,this.defaultSettings=defaultSettings,this.sortableItemKey=sortableItemKey,this.areaKey=areaKey,this.sortableItem=sortableItem,this.localSettings=settings,this.setEditButtonListener(),this.setSettingsListeners()}localSettings={};updateValue(key,value){this.localSettings[key]=value}validateValue(settingElement,key){return this.localSettings.hasOwnProperty(key)||!this.defaultSettings[key]?!1:(settingElement.value=this.defaultSettings[key],this.updateValue(key,this.defaultSettings[key]),!0)}setSettingsListeners(){let wasUpdated=[];this.settingsElements.forEach(settingElement=>{const key=settingElement.getAttribute("data-js-flexible-setting");key&&(wasUpdated.push(this.validateValue(settingElement,key)),settingElement.addEventListener("change",e=>{e.target&&(this.updateValue(key,e.target?.value),this.storageInstance.updateStorage(this.areaKey,this.localSettings,this.sortableItemKey))}))}),wasUpdated.includes(!0)&&this.storageInstance.updateStorage(this.areaKey,this.localSettings,this.sortableItemKey)}setEditButtonListener(){this.editButton.addEventListener("click",()=>{this.sortableItem.classList.contains("is-active")?this.hideDropdown(this.editButton,this.sortableItem):(this.closeAlreadyOpenDropdowns(),this.showDropdown())})}closeAlreadyOpenDropdowns(){document.querySelectorAll(".kirki-sortable-item.is-active").forEach(sortableItem=>{const editButton=sortableItem.querySelector("[data-js-sortable-edit]");editButton&&sortableItem!==this.sortableItem&&this.hideDropdown(editButton,sortableItem)})}showDropdown(){this.sortableItem.classList.add("is-active"),this.editButton.classList.remove("dashicons-edit"),this.editButton.classList.add("dashicons-no")}hideDropdown(editButton,sortableItem){sortableItem.classList.remove("is-active"),editButton.classList.add("dashicons-edit"),editButton.classList.remove("dashicons-no")}};__name(_Edit,"Edit");let Edit=_Edit;function initializeEdit(storageInstance,sortableItems,areaKey,translations){sortableItems.forEach(sortableItem=>{const sortableItemKey=sortableItem.getAttribute("data-value");let storage=storageInstance.getStorage();if(!sortableItemKey||!storage[areaKey])return;storage[areaKey].hasOwnProperty(sortableItemKey)||(storage[areaKey][sortableItemKey]=defaultEditValues,storageInstance.updateStorage(areaKey,storage[areaKey][sortableItemKey],sortableItemKey)),sortableItem.insertAdjacentHTML("beforeend",getDropdownHtml(storage[areaKey][sortableItemKey],translations));const dropdownElement=sortableItem.querySelector("[data-js-flexible-dropdown]"),editButton=sortableItem.querySelector("[data-js-sortable-edit]"),dropdownElementSettings=dropdownElement?.querySelectorAll("[data-js-flexible-setting]");!dropdownElementSettings||!editButton||new Edit(storageInstance,dropdownElement,[...dropdownElementSettings],editButton,storage[areaKey][sortableItemKey],defaultEditValues,sortableItemKey,areaKey,sortableItem)})}__name(initializeEdit,"initializeEdit");const _Storage=class _Storage{constructor(flexibleAreaNames,currentValue,hiddenSettingInstance){this.flexibleAreaNames=flexibleAreaNames,this.hiddenSettingInstance=hiddenSettingInstance,this.localSettingsStorage=currentValue,this.checkDefaultKeysExists()}localSettingsStorage={};getStorage(){return this.localSettingsStorage}updateStorage(areaKey,value,sortableItemKey=null){sortableItemKey?this.localSettingsStorage[areaKey][sortableItemKey]=value:this.localSettingsStorage[areaKey]=value,this.hiddenSettingInstance.setHiddenFieldValue(this.localSettingsStorage)}checkDefaultKeysExists(){let wasUpdated=!1;this.flexibleAreaNames.forEach(areaKey=>{this.localSettingsStorage.hasOwnProperty(areaKey)||(this.localSettingsStorage[areaKey]={},wasUpdated=!0)}),wasUpdated&&this.hiddenSettingInstance.setHiddenFieldValue(this.localSettingsStorage)}};__name(_Storage,"Storage");let Storage=_Storage;wp.customize.bind("ready",function(){if(!FlexibleHeaderSettings)return;const{flexibleAreaNames,hiddenName,responsiveNameKey,kirkiAttributeName}=getSettingsKeys(),hiddenSettingInstance=new HiddenSetting(FlexibleHeaderSettings.hiddenValue,hiddenName,kirkiAttributeName),intervalId=setInterval(()=>{if(hiddenSettingInstance.getHiddenSettingField())clearInterval(intervalId);else return;let currentValue=hiddenSettingInstance.getHiddenFieldValue()??{};const storageInstance=new Storage(flexibleAreaNames,currentValue,hiddenSettingInstance);flexibleAreaNames.forEach(areaKey=>{const setting=document.querySelector(`[${kirkiAttributeName}="${areaKey}"]`),responsiveSetting=document.querySelector(`[${kirkiAttributeName}="${areaKey}${responsiveNameKey}"]`);if(!setting||!responsiveSetting)return;const getSortableItemsInstance=new GetSortableItems(setting,responsiveSetting);addEditIconToSortables(setting),initializeEdit(storageInstance,getSortableItemsInstance.getSortableItems(),areaKey,FlexibleHeaderSettings.lang)})},1e3)});
//# sourceMappingURL=customizer-flexible-header.B2bRNqf5.js.map
