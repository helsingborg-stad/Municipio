{"version":3,"file":"event-source-progress.CE63KK9E.js","sources":["../../source/js/admin/eventSourceProgress/EventSourceHandlerWithProgressBar.ts","../../source/js/admin/eventSourceProgress/ProgressBar.ts","../../source/js/admin/eventSourceProgress/UIComponents/ProgressBarWithLabel.ts","../../source/js/admin/eventSourceProgress/EventSourceTrigger.ts","../../source/js/admin/eventSourceProgress/index.ts"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\n\nimport { IProgressBar } from \"./IProgressBar\";\n\nexport default class EventSourceHandlerWithProgressBar {\n    private source: EventSource | null = null;\n\n    constructor(private target: HTMLElement, private url: string, private progressBar: IProgressBar) {\n    }\n\n    public start(): void {\n        this.source = new EventSource(this.url);\n        this.disableAllTriggersWithSameUrl();\n        this.progressBar.show();\n        this.addEventListeners(this.source);\n    }\n\n    private disableAllTriggersWithSameUrl(): void {\n        document.querySelectorAll(`[data-js-progress-url=\"${this.url}\"]`).forEach((element) => {\n            element.setAttribute('disabled', 'disabled');\n        });\n    }\n\n\n    private addEventListeners(source: EventSource): void {\n        source.addEventListener('message', this.updateLabel.bind(this));\n        source.addEventListener('progress', this.updateProgress.bind(this));\n        source.addEventListener('finish', this.finish.bind(this));\n        source.addEventListener('error', this.handleError.bind(this));\n    }\n\n    private removeEventListeners(source: EventSource): void {\n        source.removeEventListener('message', this.updateLabel.bind(this));\n        source.removeEventListener('progress', this.updateProgress.bind(this));\n        source.removeEventListener('finish', this.finish.bind(this));\n        source.removeEventListener('error', this.handleError.bind(this));\n    }\n\n    private updateLabel(event: MessageEvent) {\n        this.progressBar.update({ label: event.data, value: null });\n    }\n\n    private updateProgress(event: MessageEvent) {\n        this.progressBar.update({ label: null, value: event.data });\n    }\n\n    private finish(event: MessageEvent) {\n        this.progressBar.update({ label: event.data, value: 100 });\n        this.source!.close();\n        this.removeEventListeners(this.source!);\n    }\n\n    private handleError(event: MessageEvent) {\n        this.progressBar.update({ label: 'An error occurred', value: 100 });\n        this.source!.close();\n        this.removeEventListeners(this.source!);\n    }\n}","import { IProgressBar, ProgressBarUpdate } from \"./IProgressBar\";\nimport ProgressBarWithLabel from \"./UIComponents/ProgressBarWithLabel\";\n\nexport default class ProgressBar implements IProgressBar {\n\n    constructor(private element: ProgressBarWithLabel, private insertAfterElement: HTMLElement) {\n    }\n\n    public update(event: ProgressBarUpdate): void {\n        if (event.label !== null) {\n            this.element.setAttribute('label', event.label);\n        }\n\n        if (event.value !== null) {\n            this.element.setAttribute('progress', event.value.toString());\n        }\n    }\n\n    public show(): void {\n        this.insertAfterElement.insertAdjacentElement('afterend', this.element);\n    }\n\n    public hide(): void {\n        this.element.remove();\n    }\n}","export default class ProgressBarWithLabel extends HTMLElement {\n    private progressElement: HTMLElement;\n    private labelElement: HTMLElement;\n    private label: string;\n    private progress: number;\n    private root: ShadowRoot;\n    private uniqueId: string = '';\n    public static customElementName: string = 'progress-bar-with-label';\n\n    constructor() {\n        super();\n\n        this.uniqueId = this.getUniqueID();\n        this.root = this.attachShadow({ mode: 'open' });\n\n        this.root.innerHTML = `\n            <style> \n                progress {\n                    border: none;\n                    border-radius: 3px;\n                    background-color: #f3f3f3;\n                    margin-right: 8px;\n                    min-width: 192px;\n                }\n\n                ::-webkit-progress-bar {\n                    background-color: rgba(0, 0, 0, 0.15);\n                    border-radius: 3px;\n                    border: none;\n                }\n\n                ::-webkit-progress-value {\n                    background-color: #2271b1;\n                    border-radius: 3px;\n                    transition: width 1s;\n                }\n\n                label {\n                    font-style: italic;\n                } \n            </style>\n            <progress part=\"progress-bar\" id=\"${this.uniqueId}\"></progress>\n            <label part=\"label\" for=\"${this.uniqueId}\"></label>\n        `;\n\n        this.progressElement = this.root.querySelector('progress')!;\n        this.labelElement = this.root.querySelector('label')!;\n        this.label = \"\";\n        this.progress = 0;\n\n        this.progressElement.setAttribute(\"value\", this.progress.toString());\n        this.progressElement.setAttribute(\"max\", \"100\");\n    }\n\n    public getElement(): HTMLElement {\n        return this;\n    }\n\n    public setProgress(value: number): void {\n        this.progress = Math.min(100, Math.max(0, value));\n        if (isNaN(this.progress)) {\n            this.progress = 0;\n        }\n        this.progressElement!.setAttribute(\"value\", this.progress.toString());\n    }\n\n    public setLabel(label: string): void {\n        this.label = label;\n        this.labelElement.textContent = this.label;\n    }\n\n    private getUniqueID(): string {\n        return Math.random().toString(36).substr(2, 9);\n    }\n\n    static get observedAttributes() {\n        return ['label', 'progress'];\n    }\n\n    attributeChangedCallback(name: string, oldValue: string, newValue: string) {\n        if (oldValue !== newValue) {\n            switch (name) {\n                case 'label':\n                    this.setLabel(newValue);\n                    break;\n                case 'progress':\n                    this.setProgress(Number(newValue));\n                    break;\n            }\n        }\n    }\n\n    connectedCallback() {\n        if (this.hasAttribute('label')) {\n            this.setLabel(this.getAttribute('label')!);\n        }\n        if (this.hasAttribute('progress')) {\n            this.setProgress(Number(this.getAttribute('progress')));\n        }\n    }\n}\n","import EventSourceHandlerWithProgressBar from \"./EventSourceHandlerWithProgressBar\";\nimport { IProgressBar } from \"./IProgressBar\";\nimport ProgressBar from \"./ProgressBar\";\nimport ProgressBarWithLabel from \"./UIComponents/ProgressBarWithLabel\";\n\nexport default class EventSourceTrigger {\n\n    private eventSourceHandlerWithProgressBar: EventSourceHandlerWithProgressBar;\n\n    constructor(private triggerElement: HTMLElement, private eventSourceUrl: string) {\n        this.eventSourceHandlerWithProgressBar = new EventSourceHandlerWithProgressBar(this.triggerElement, this.eventSourceUrl, this.createProgressBar());\n        this.triggerElement.addEventListener('click', this.handleClick.bind(this));\n    }\n\n    private handleClick(event: Event) {\n        event.preventDefault();\n        this.eventSourceHandlerWithProgressBar.start();\n    }\n\n    private createProgressBar(): IProgressBar {\n        const progressBarElement = document.createElement(ProgressBarWithLabel.customElementName) as ProgressBarWithLabel;\n        const progressBar = new ProgressBar(progressBarElement, this.triggerElement);\n        return progressBar;\n    }\n}","import EventSourceTrigger from \"./EventSourceTrigger\";\nimport ProgressBarWithLabel from \"./UIComponents/ProgressBarWithLabel\";\n\nexport default (() => {\n\n    /**\n     * Register the custom element for the progress bar\n     */\n    customElements.define(ProgressBarWithLabel.customElementName, ProgressBarWithLabel);\n\n    /**\n     * Setup the progress bar for each element with the data-js-progress-url attribute\n     */\n    document.querySelectorAll('[data-js-progress-url]').forEach((element) => {\n        new EventSourceTrigger(element as HTMLElement, element.getAttribute('data-js-progress-url') as string);\n    });\n\n})();"],"names":[],"mappings":"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"}